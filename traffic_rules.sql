DROP TABLE ROLE;
DROP TABLE USERl;
DROP TABLE ANSWER_CATEGORY;
DROP TABLE ANSWER;
DROP TABLE QUESTION;
DROP TABLE TEST;
DROP TABLE TEST_SECTION;
DROP TABLE TEST_SECTION_QUESTION_XREF;
DROP TABLE TEST_RESULT;
DROP TABLE TEST_RESULT_ANSWERS_FACTS;

CREATE TABLE ROLE (
  ID INTEGER PRIMARY KEY NOT NULL,
  DESCRIPTION TEXT NOT NULL
);

CREATE TABLE USER (
  ID INTEGER PRIMARY KEY NOT NULL,
  FIRST_NAME TEXT NOT NULL,
  LAST_NAME TEXT NOT NULL,
  ROLE_ID INTEGER NOT NULL,
  FOREIGN KEY(ROLE_ID) REFERENCES ROLE(ID)
);

CREATE TABLE ANSWER_CATEGORY (
  ID INTEGER PRIMARY KEY     NOT NULL,
  DESCRIPTION        TEXT    NOT NULL
);

CREATE TABLE ANSWER (
  ID INTEGER PRIMARY KEY     NOT NULL,
  DESCRIPTION        TEXT    NOT NULL,
  ANSWER_CATEGORY           INTEGER    NOT NULL,
  FOREIGN KEY(ANSWER_CATEGORY) REFERENCES ANSWER_CATEGORY(ID)
);

CREATE TABLE QUESTION (
  ID INTEGER PRIMARY KEY        NOT NULL,
  DESCRIPTION        TEXT       NOT NULL,
  ANSWER_CATEGORY    INTEGER    NOT NULL,
  CORRECT_ANSWER_ID  INTEGER    NOT NULL,

  FOREIGN KEY(ANSWER_CATEGORY) REFERENCES ANSWER_CATEGORY(ID),
  FOREIGN KEY(CORRECT_ANSWER_ID) REFERENCES ANSWER(ID)
);

CREATE TABLE TEST (
  ID INTEGER PRIMARY KEY NOT NULL,
  DESCRIPTION        TEXT    NOT NULL,
  TEACHER_ID INTEGER NOT NULL,
  FOREIGN KEY(TEACHER_ID) REFERENCES USER(ID)
);

CREATE TABLE TEST_SECTION (
  ID INTEGER PRIMARY KEY NOT NULL,
  DESCRIPTION        TEXT    NOT NULL,
  TEST_ID            INTEGER NOT NULL,
  FOREIGN KEY(TEST_ID) REFERENCES TEST(ID)
);

CREATE TABLE TEST_SECTION_QUESTION_XREF (
  TEST_SECTION_ID INTEGER NOT NULL,
  QUESTION_ID INTEGER NOT NULL,
  FOREIGN KEY (TEST_SECTION_ID) REFERENCES TEST_SECTION(ID),
  FOREIGN KEY (QUESTION_ID) REFERENCES  QUESTION(ID)
);

CREATE TABLE TEST_RESULT (
  ID INTEGER PRIMARY KEY NOT NULL,
  STUDENT_ID INTEGER NOT NULL,
  TEST_ID INTEGER NOT NULL,
  FOREIGN KEY(STUDENT_ID) REFERENCES USER(ID),
  FOREIGN KEY(TEST_ID) REFERENCES TEST(ID)
);

CREATE TABLE TEST_RESULT_ANSWERS_FACTS (
  TEST_RESULT_ID INTEGER NOT NULL,
  QUESTION_ID INTEGER NOT NULL,
  ANSWER_ID INTEGER NOT NULL,
  IS_CORRECT INTEGER NOT NULL,
  FOREIGN KEY (TEST_RESULT_ID) REFERENCES TEST_RESULT(ID),
  FOREIGN KEY(QUESTION_ID) REFERENCES QUESTION(ID),
  FOREIGN KEY(ANSWER_ID) REFERENCES ANSWER(ID)
);


INSERT INTO ROLE (ID, DESCRIPTION) VALUES (1, "Admin");
INSERT INTO ROLE (ID, DESCRIPTION) VALUES (2, "Teacher");
INSERT INTO ROLE (ID, DESCRIPTION) VALUES (3, "Student");
INSERT INTO USER (ID, FIRST_NAME, LAST_NAME, IMAGE_URL, ROLE_ID) VALUES (1, "Andrey", "Petrov", NULL, 1);
INSERT INTO USER (ID, FIRST_NAME, LAST_NAME, IMAGE_URL, ROLE_ID) VALUES (2, "Aleksandar", "Petrov", NULL, 1);
INSERT INTO USER (ID, FIRST_NAME, LAST_NAME, IMAGE_URL, ROLE_ID) VALUES (2, "Учителко", "Учителков", NULL, 2);
INSERT INTO USER (ID, FIRST_NAME, LAST_NAME, IMAGE_URL, ROLE_ID) VALUES (2, "Йордан", "Илиев", NULL, 3);
INSERT INTO USER (ID, FIRST_NAME, LAST_NAME, IMAGE_URL, ROLE_ID) VALUES (2, "Теодор", "Стаматов", NULL, 3);
